# linux 文件系统

## 文件存储 

文件存储在磁盘上，磁盘的最小存储单元是扇区，每个扇区存储512个字节（0.5KB）

操作系统在读取文件时，一般一次读取多个扇区（一个个读太慢），即一次行读取一个块，这种由多个扇区组成的"块"，是文件存取的最小单位。"块"的大小，最常见的是4KB，即连续八个 sector组成一个 block

文件的数据都存储在块中，如果要找到块，我们还必须找到一个地方储存文件的元信息，包括文件的创建者，创建时间等等基础信息。这个存储元数据的qu区域就是inode，

inode相当于书籍的目录，我们必须先找到目录，才能找到内容所在的章节和页码


// TODO SSD 的寻址和存储

## 2. inode

### 2.1 inode 包含的内容

inode包含文件的元信息,通常可以使用 ``stat`` 命令查看

* 文件的字节数
* 文件拥有者的User ID
* 文件的Group ID
* 文件的读、写、执行权限
* 文件的时间戳，共有三个：ctime指inode上一次变动的时间，mtime指文件内容上一次变动的时间，atime指文件上一次打开的时间。
* 链接数，即有多少文件名指向这个inode
* 文件数据block的位置

### 2.2 node的大小

inode 也会占用一定的磁盘空间,通常占磁盘大约1%的空间 默认情况下，操作系统将磁盘分为两块，一块inode区，一块数据区。 

每个inode节点的大小，一般是128字节或256字节, 在linux中可以通过df等命令查看inodes数以及inode的大小

### 2.3 inode 特性

在操作系统中，每个文件都有一个inode，系统都是通过inode的号码来区分文件，而不是通过文件名称来区分

所以系统打开文件一般步骤为 1. 查询文件的inode号码 2. 通过inode号码查询到inode内容 3.通过inode内容查询文件的详细数据

在linux／unix中，文件夹也是一种文件，文件目录有一系列的文件目录项组成，每个目录项包含两部分 文件名和文件的inode号码

### 2.4 硬连接 软连接 

``硬连接``: ``ln 源文件 目标文件``  运行这条命令以后，源文件与目标文件的inode号码相同，都指向同一个inode。inode信息中有一项叫做"链接数"，记录指向该inode的文件名总数，这时就会增加1

创建目录时，默认会生成两个目录项："."和".." ``.`` 代表当前目录 ``..`` 代表上级目录  系统的pwd命令就依据这两个命令来获取 如果 . 和  .. 的inode相同，那么说明到达了根目录

    访问一个文件的时候，先进入目录，目录中有相应的目录项，目录项中有对应的文件名和inode号，通过里面的指针指向相应的数据块，这样就访问到文件的内容了。目录这种“特殊的文件”，可以简单地理解为是一张表，这张表里面存放了属于该目录的文件的文件名，以及所匹配的inode编号,它本身的数据也放在数据区中；读写一个文件时就这样来回的从inode和数据区之间切换。可以把文件比作一本书，inode相当于书的目录，数据区相当于书的内容，读书时得先查目录，这本书呢又放在读书馆的书架上，书架可以理解为是目录，看书前先查书架子的索引。

前者的inode号码就是当前目录的inode号码，等同于当前目录的"硬链接"；后者的inode号码就是当前目录的父目录的inode号码，等同于父目录的"硬链接"。所以，任何一个目录的"硬链接"总数，总是等于2加上它的子目录总数（含隐藏目录）

``软连接``: ``ln -s 源文文件或目录(A) 目标文件或目录(B)``  文件A和文件B的inode号码虽然不一样，但是文件A的内容是文件B的路径。读取文件A时，系统会自动将访问者导向文件B。因此，无论打开哪一个文件，最终读取的都是文件B 

// TODO inode 的存储位置 